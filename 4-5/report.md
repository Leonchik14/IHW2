# Отчёт

## Информация
- Студент: Крйанов Леонид Игоревич_ 
- Группа: _БПИ 223_
- Вариант: _№7_

## Задание

### Задача №7
Задача о читателях и писателях («подтвержденное чтение»).
Базу данных, представленную массивом целых положительных чисел, разделяют два типа процессов: N читателей и K писателей. Читатели периодически просматривают случайные записи базы данных и выводя номер свой номер (например, PID), индекс записи, ее значение, а также вычисленное значение, которое является произведением числа на номер записи. Писатели изменяют случайные записи на случайное число и также выводят информацию о своем номере, индексе записи, старом значении и новом значении. Предполагается, что в начале БД находится в непротиворечивом состоянии (все числа отсортированы). Каждая отдельная новая запись переводит БД из одного непротиворечивого состояния в другое (то есть, новая сортировка может поменять индексы записей или переставить числа). Транзакции выполняются в режиме «подтвержденного чтения», то есть процесс-писатель не может получить доступ к БД в том случае, если ее занял другой процесс–писатель или процесс–читатель. К БД может обратиться одновременно сколько угодно процессов–читателей. Процесс читатель получает доступ к БД, даже если ее уже занял процесс–писатель.
Создать многопроцессорное приложение с потоками-писателями и потоками-читателями.
Каждый читатель и писатель моделируется отдельным процессом.

### Требования на 4-5 баллов

Разработать консольное приложение, в котором единый родительский процесс запускает требуемое число дочерних процессов.

Требования:
1. В отчете необходимо привести фамилию, имя, отчество исполнителя, группу.
2. Привести номер варианта и условие задачи.
3. Представить сценарий решаемой задачи поясняющий, каким образом исходные сущности и их поведение отображаются в процессы и их взаимодействие.
4. В зависимости от выбранной схемы решения программа может использовать обмен данными через общую или разделяемую память.

Применение семафоров в программе возможно по одному
из следующих вариантов (на выбор разработчика):
- Множество процессов взаимодействуют с использованием именованных POSIX семафоров. Обмен данными ведется через разделяемую память в стандарте POSIX.
- Множество процессов взаимодействуют с использованием неименованных POSIX семафоров расположенных в разделяемой памяти. Обмен данными также ведется через разделяемую память в стандарте POSIX.

5. Реализовать завершение программы в соответствии с условием задачи, а также предусмотреть корректное завершение по прерыванию с клавиатуры по соответствующему сигналу.
6. В программе предусмотреть удаление семафоров и разделяемой памяти по ее завершению любым из способов.
7. Результаты работы программы должны быть отражены в отчете.

# Решение

## Общий принцип решения

Создаётся разделяемая память для хранения базы данных (массив целых чисел) и семафор для доступа к изменению базы данных (1 - можно производить измерения, 0 - ресурс занят,надо ждать). Процессы писатели после изменения записи в базе данных также сортируют массив. Независимо от операций с базами данных процессы читатели могут считать нужные ячейки массива и произвести подсчёт требуемого значения. Такая логика поведения процессов читателей соответствует режиму "подтвержденного чтения" и иногда может привести к чтение устаревших данных (к примеру, если считывать данные во время сортировки).

## Объяснение частей решения

Для этой задачи было решено использовать именованные семафоры POSIX.

В коде можно менять переменную `PRINT_DB` для регулирования вывода базы данных в консоль. Также можно изменить переменную `PROCESSES_SLEEP_TIME` для регулирования времени ожидания процессов (в секундах).

Сигнал о прекращении не завершает работу родительского процесса (в отличие от дочерних процессов), а позволяет корректно освободить используемые ресурсы (семафор и разделяемую память).

# Примеры работы программы

## Пример 1

Работа программы с выводом базы данных (PRINT_DB = 1):
![alt text](image-1.png)

## Пример 2

Работа программы без вывода базы данных (PRINT_DB = 0):
![alt text](image-2.png)

